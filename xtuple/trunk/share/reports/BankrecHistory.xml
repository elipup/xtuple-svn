<!DOCTYPE openRPTDef>
<report>
 <title>Bank Reconciliation History</title>
 <name>BankrecHistory</name>
 <description></description>
 <size>Letter</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>50</rightmargin>
 <leftmargin>50</leftmargin>
 <querysource>
  <name>detail</name>
  <sql>SELECT gltrans_id, formatDate(gltrans_date) AS f_date,
       gltrans_docnumber,
       CASE WHEN gltrans_doctype = 'CK' THEN 'CHEQUES RECONCILIES'
            WHEN gltrans_doctype = 'CR' THEN 'DEPOTS RECONCILIES'
            ELSE 'AJUSTEMENTS RECONCILIES' END AS type,
       CASE WHEN gltrans_doctype = 'CK' THEN '1'
            WHEN gltrans_doctype = 'CR' THEN '2'
            ELSE '3' END AS sort,
       gltrans_notes AS notes,
       formatMoney(currtolocal(bankaccnt_curr_id,gltrans_amount,gltrans_date) * -1) AS f_amount,
       gltrans_amount * -1 AS c_amount 
  FROM gltrans, bankrecitem 
    JOIN bankrec ON (bankrecitem_bankrec_id=bankrec_id)
    JOIN bankaccnt ON (bankaccnt_id=bankrec_bankaccnt_id)
 WHERE ((bankrecitem_bankrec_id=&lt;? value("bankrec_id") ?>)
   AND (bankrecitem_source='GL')
   AND (bankrecitem_source_id=gltrans_id) ) 

UNION

SELECT gltrans_id, formatDate(gltrans_date) AS f_date,
       gltrans_docnumber,
       CASE WHEN gltrans_doctype = 'CK' THEN 'CHEQUES EN CIRCULATION'
            WHEN gltrans_doctype = 'CR' THEN 'DEPOTS EN CIRCULATION'
            ELSE 'AJUSTEMENTS EN CIRCULATION' END AS type,
       CASE WHEN gltrans_doctype = 'CK' THEN '4'
            WHEN gltrans_doctype = 'CR' THEN '5'
            ELSE '6' END AS sort,
       gltrans_notes AS notes,
       formatMoney(currtolocal(bankaccnt_curr_id,gltrans_amount,gltrans_date) * -1) AS f_amount,
       gltrans_amount * -1 AS c_amount 
  FROM gltrans JOIN bankaccnt ON bankaccnt_accnt_id = gltrans_accnt_id JOIN bankrec ON bankrec_bankaccnt_id = bankaccnt_id 
 WHERE bankrec_id=&lt;? value("bankrec_id") ?>
  AND gltrans_rec = FALSE
ORDER BY  sort, f_date, gltrans_id;</sql>
 </querysource>
 <querysource>
  <name>head</name>
  <sql>SELECT (bankaccnt_name || '-' || bankaccnt_descrip) AS f_bankaccnt,
       (formatDate(bankrec_opendate) || '-' || formatDate(bankrec_enddate)) AS f_bankrec,
       bankrec_username AS f_username, formatDate(bankrec_created) AS f_created,
       formatDate(bankrec_opendate) AS f_opendate,
       formatDate(bankrec_enddate) AS f_enddate,
       formatMoney(bankrec_openbal) AS f_openbal,
       formatMoney(bankrec_endbal) AS f_endbal,
       text('Opening Balance') AS f_opendescrip,
       text('Ending Balance') AS f_enddescrip
  FROM bankrec, bankaccnt
 WHERE ((bankrec_bankaccnt_id=bankaccnt_id)
   AND  (bankrec_id=&lt;? value("bankrec_id") ?>));</sql>
 </querysource>
 <querysource>
  <name>Subtotal</name>
  <sql>SELECT formatMoney(bankrec_openbal - SUM(gltrans_amount)) AS sub_amount
 FROM gltrans JOIN bankaccnt ON bankaccnt_accnt_id = gltrans_accnt_id JOIN bankrec ON bankrec_bankaccnt_id = bankaccnt_id 
 WHERE bankrec_id=&lt;? value("bankrec_id") ?>
  AND gltrans_rec = FALSE
  AND gltrans_doctype = 'CK'
GROUP BY bankrec_openbal;
</sql>
 </querysource>
 <querysource>
  <name>CheckCircAmount</name>
  <sql>SELECT formatMoney(SUM(gltrans_amount)) AS chk_circ_amount
 FROM gltrans JOIN bankaccnt ON bankaccnt_accnt_id = gltrans_accnt_id JOIN bankrec ON bankrec_bankaccnt_id = bankaccnt_id 
 WHERE bankrec_id=&lt;? value("bankrec_id") ?>
  AND gltrans_rec = FALSE
  AND gltrans_doctype = 'CK';
</sql>
 </querysource>
 <querysource>
  <name>DepositCircAmount</name>
  <sql>SELECT formatMoney(SUM(gltrans_amount)) AS dep_circ_amount
  FROM gltrans JOIN bankaccnt ON bankaccnt_accnt_id = gltrans_accnt_id JOIN bankrec ON bankrec_bankaccnt_id = bankaccnt_id 
 WHERE bankrec_id=&lt;? value("bankrec_id") ?>
  AND gltrans_rec = FALSE
  AND gltrans_doctype = 'CR';
</sql>
 </querysource>
 <querysource>
  <name>AdjustmentCircAmount</name>
  <sql>SELECT formatMoney(SUM(gltrans_amount)) AS adj_circ_amount
  FROM gltrans JOIN bankaccnt ON bankaccnt_accnt_id = gltrans_accnt_id JOIN bankrec ON bankrec_bankaccnt_id = bankaccnt_id 
 WHERE bankrec_id=&lt;? value("bankrec_id") ?>
  AND gltrans_rec = FALSE
  AND gltrans_doctype &lt;> 'CK'
  AND gltrans_doctype &lt;> 'CR';
</sql>
 </querysource>
 <querysource>
  <name>ExpectedAmount</name>
  <sql></sql>
 </querysource>
 <rpthead>
  <height>138</height>
  <label>
   <rect>
    <x>645</x>
    <y>100</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Amount</string>
  </label>
  <label>
   <rect>
    <x>370</x>
    <y>50</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Reporté par:</string>
  </label>
  <field>
   <rect>
    <x>100</x>
    <y>120</y>
    <width>535</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_opendescrip</column>
   </data>
  </field>
  <label>
   <rect>
    <x>100</x>
    <y>100</y>
    <width>150</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Doc. Number/Notes</string>
  </label>
  <field>
   <rect>
    <x>145</x>
    <y>65</y>
    <width>220</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_bankrec</column>
   </data>
  </field>
  <line>
   <xstart>5</xstart>
   <ystart>115</ystart>
   <xend>745</xend>
   <yend>115</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>370</x>
    <y>65</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Date Reporté:</string>
  </label>
  <field>
   <rect>
    <x>145</x>
    <y>50</y>
    <width>245</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_bankaccnt</column>
   </data>
  </field>
  <field>
   <rect>
    <x>475</x>
    <y>65</y>
    <width>220</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_created</column>
   </data>
  </field>
  <label>
   <rect>
    <x>10</x>
    <y>100</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Dist. Date</string>
  </label>
  <label>
   <rect>
    <x>23</x>
    <y>64</y>
    <width>117</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Reconciliation Bancaire:</string>
  </label>
  <field>
   <rect>
    <x>10</x>
    <y>120</y>
    <width>80</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_opendate</column>
   </data>
  </field>
  <field>
   <rect>
    <x>475</x>
    <y>50</y>
    <width>220</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_username</column>
   </data>
  </field>
  <label>
   <rect>
    <x>40</x>
    <y>50</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Compte de Banque:</string>
  </label>
  <label>
   <rect>
    <x>280</x>
    <y>5</y>
    <width>465</width>
    <height>38</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>18</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Bank Reconciliation History</string>
  </label>
  <field>
   <rect>
    <x>645</x>
    <y>120</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_openbal</column>
   </data>
  </field>
 </rpthead>
 <pghead>
  <firstpage/>
  <height>6</height>
 </pghead>
 <pghead>
  <height>21</height>
  <line>
   <xstart>5</xstart>
   <ystart>15</ystart>
   <xend>745</xend>
   <yend>15</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>100</x>
    <y>0</y>
    <width>150</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Doc. Number/Notes</string>
  </label>
  <label>
   <rect>
    <x>10</x>
    <y>0</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Dist. Date</string>
  </label>
  <label>
   <rect>
    <x>645</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Amount</string>
  </label>
 </pghead>
 <section>
  <name>detail</name>
  <group>
   <name>type</name>
   <column>sort</column>
   <head>
    <height>27</height>
    <field>
     <rect>
      <x>4</x>
      <y>6</y>
      <width>168</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>type</column>
     </data>
    </field>
   </head>
   <foot>
    <height>29</height>
    <field>
     <rect>
      <x>645</x>
      <y>0</y>
      <width>100</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <right/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>c_amount</column>
     </data>
     <tracktotal subtotal="true" builtin="true" >qty</tracktotal>
    </field>
    <field>
     <rect>
      <x>438</x>
      <y>0</y>
      <width>168</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>type</column>
     </data>
    </field>
    <label>
     <rect>
      <x>399</x>
      <y>0</y>
      <width>49</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>normal</weight>
     </font>
     <left/>
     <vcenter/>
     <string>TOTAL</string>
    </label>
   </foot>
  </group>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>18</height>
   <field>
    <rect>
     <x>100</x>
     <y>0</y>
     <width>94</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>gltrans_docnumber</column>
    </data>
   </field>
   <field>
    <rect>
     <x>206</x>
     <y>0</y>
     <width>430</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>notes</column>
    </data>
   </field>
   <field>
    <rect>
     <x>645</x>
     <y>0</y>
     <width>100</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_amount</column>
    </data>
   </field>
   <field>
    <rect>
     <x>10</x>
     <y>0</y>
     <width>80</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_date</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>15</height>
  <field>
   <rect>
    <x>705</x>
    <y>0</y>
    <width>40</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
  <label>
   <rect>
    <x>0</x>
    <y>0</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <label>
   <rect>
    <x>615</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
  <field>
   <rect>
    <x>80</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
 </pgfoot>
 <rptfoot>
  <height>126</height>
  <field>
   <rect>
    <x>237</x>
    <y>27</y>
    <width>80</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_enddate</column>
   </data>
  </field>
  <field>
   <rect>
    <x>348</x>
    <y>27</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_endbal</column>
   </data>
  </field>
  <field>
   <rect>
    <x>46</x>
    <y>27</y>
    <width>197</width>
    <height>17</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>f_enddescrip</column>
   </data>
  </field>
  <label>
   <rect>
    <x>38</x>
    <y>10</y>
    <width>102</width>
    <height>16</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>RECONCILIATION</string>
  </label>
  <label>
   <rect>
    <x>163</x>
    <y>45</y>
    <width>162</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Add: Checks in Circulation:</string>
  </label>
  <label>
   <rect>
    <x>262</x>
    <y>61</y>
    <width>56</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Subtotal:</string>
  </label>
  <label>
   <rect>
    <x>160</x>
    <y>75</y>
    <width>163</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Deduct: Stores in Circulation:</string>
  </label>
  <label>
   <rect>
    <x>146</x>
    <y>91</y>
    <width>177</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Add: Adjustments in Circulation:</string>
  </label>
  <label>
   <rect>
    <x>110</x>
    <y>107</y>
    <width>219</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Balance Anticipated on State of Count:</string>
  </label>
  <field>
   <rect>
    <x>350</x>
    <y>46</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>CheckCircAmount</query>
    <column>chk_circ_amount</column>
   </data>
  </field>
  <field>
   <rect>
    <x>352</x>
    <y>63</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>Subtotal</query>
    <column>sub_amount</column>
   </data>
  </field>
  <field>
   <rect>
    <x>351</x>
    <y>78</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>DepositCircAmount</query>
    <column>dep_circ_amount</column>
   </data>
  </field>
  <field>
   <rect>
    <x>349</x>
    <y>94</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>AdjustmentCircAmount</query>
    <column>adj_circ_amount</column>
   </data>
  </field>
  <field>
   <rect>
    <x>350</x>
    <y>109</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <data>
    <query>ExpectedAmount</query>
    <column>exp_amount</column>
   </data>
  </field>
 </rptfoot>
</report>
