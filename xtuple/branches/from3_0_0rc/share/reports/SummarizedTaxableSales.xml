<!DOCTYPE openRPTDef>
<report>
 <title>Summarized Taxable Sales</title>
 <name>SummarizedTaxableSales</name>
 <description></description>
 <size>Letter</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>50</rightmargin>
 <leftmargin>50</leftmargin>
 <querysource>
  <name>head</name>
  <sql>SELECT &lt;? if exists("tax_id") ?>
         ( SELECT (tax_code||' - '||tax_descrip)
             FROM tax
            WHERE (tax_id=&lt;? value("tax_id") ?>) )
       &lt;? else ?>
         text('All Tax Codes')
       &lt;? endif ?>
       AS taxcode,
       formatDate(&lt;? value("startDate") ?>) AS startdate,
       formatDate(&lt;? value("endDate") ?>) AS enddate;</sql>
 </querysource>
 <querysource>
  <name>detail</name>
  <sql>SELECT (tax_code||'-'||tax_descrip) AS taxcode,
       formatMoney((
	  SELECT COALESCE(SUM(ROUND(cohist_qtyshipped *
				    currToCurr(cohist_curr_id, baseCurrId(),
					       cohist_unitprice,
					       cohist_invcdate),2)), 0)
	  FROM cohist
	  WHERE ((cohist_tax_id=tax_id)
	    AND  (cohist_itemsite_id&lt;>-1)
	    AND  (cohist_invcdate BETWEEN &lt;? value("startDate") ?>
				      AND &lt;? value("endDate") ?>))
       )) AS f_sales,
       formatMoney((
	  SELECT COALESCE(SUM(ROUND(currToCurr(cohist_curr_id, baseCurrId(),
					       cohist_unitprice,
					       cohist_invcdate), 2)), 0)
	  FROM cohist
	  WHERE ((cohist_tax_id=tax_id)
	    AND  (cohist_misc_type='F')
	    AND  (cohist_invcdate BETWEEN &lt;? value("startDate") ?>
				      AND &lt;? value("endDate") ?>))
       )) AS f_freight,
       formatBoolYN(EXISTS(SELECT *
			   FROM taxsel
			   WHERE ((taxsel_tax_id=tax_id)
			     AND  (taxsel_taxtype_id=getFreightTaxTypeId()))
       )) AS f_taxfreight,
       formatMoney((
	 SELECT COALESCE(SUM(ROUND(currToCurr(cohist_curr_id, baseCurrId(),
					      COALESCE(cohist_tax_ratea,0) +
					      COALESCE(cohist_tax_rateb,0) +
					      COALESCE(cohist_tax_ratec, 0),
					      cohist_invcdate), 2)), 0)
	 FROM cohist
	 WHERE ((cohist_tax_id=tax_id)
--          AND (cohist_misc_type='T')
	    AND (cohist_invcdate BETWEEN &lt;? value("startDate") ?>
				      AND &lt;? value("endDate") ?>))
       )) AS f_taxbase,
       formatMoney((
	 SELECT COALESCE(SUM(ROUND(currToCurr(cohist_curr_id,
					      COALESCE(taxauth_curr_id,
						       baseCurrId()),
					      COALESCE(cohist_tax_ratea,0) +
					      COALESCE(cohist_tax_rateb,0) +
					      COALESCE(cohist_tax_ratec, 0),
					      cohist_invcdate), 2)), 0)
	 FROM cohist
	 WHERE ((cohist_tax_id=tax_id)
--          AND (cohist_misc_type='T')
	    AND (cohist_invcdate BETWEEN &lt;? value("startDate") ?>
				      AND &lt;? value("endDate") ?>))
       )) AS f_tax,
       currConcat(COALESCE(taxauth_curr_id, baseCurrId())) AS taxauthcurr
FROM tax LEFT OUTER JOIN
     (taxsel JOIN taxauth ON (taxsel_taxauth_id=taxauth_id))
	ON (taxsel_tax_id=tax_id)
&lt;? if exists("tax_id") ?>
WHERE (tax_id=&lt;? value("tax_id") ?>) 
&lt;? endif ?>
GROUP BY tax_id, tax_code, tax_descrip, tax_freight, taxauth_curr_id;</sql>
 </querysource>
 <rpthead>
  <height>221</height>
  <label>
   <rect>
    <x>5</x>
    <y>200</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Tax Code</string>
  </label>
  <label>
   <rect>
    <x>600</x>
    <y>200</y>
    <width>90</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Tax</string>
  </label>
  <line>
   <xstart>5</xstart>
   <ystart>215</ystart>
   <xend>745</xend>
   <yend>215</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>430</x>
    <y>200</y>
    <width>70</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Freight Taxed</string>
  </label>
  <label>
   <rect>
    <x>600</x>
    <y>184</y>
    <width>150</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>In Tax Authority's Currency</string>
  </label>
  <label>
   <rect>
    <x>700</x>
    <y>200</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Currency</string>
  </label>
  <field>
   <rect>
    <x>140</x>
    <y>100</y>
    <width>385</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>taxcode</column>
   </data>
  </field>
  <label>
   <rect>
    <x>230</x>
    <y>200</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Sales</string>
  </label>
  <field>
   <rect>
    <x>140</x>
    <y>140</y>
    <width>200</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>enddate</column>
   </data>
  </field>
  <label>
   <rect>
    <x>30</x>
    <y>100</y>
    <width>104</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Tax Code:</string>
  </label>
  <label>
   <rect>
    <x>30</x>
    <y>140</y>
    <width>104</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>End Date:</string>
  </label>
  <label>
   <rect>
    <x>30</x>
    <y>120</y>
    <width>104</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Start Date:</string>
  </label>
  <label>
   <rect>
    <x>275</x>
    <y>10</y>
    <width>450</width>
    <height>38</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>18</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Summarized Taxable Sales</string>
  </label>
  <label>
   <rect>
    <x>500</x>
    <y>200</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Tax</string>
  </label>
  <field>
   <rect>
    <x>140</x>
    <y>120</y>
    <width>200</width>
    <height>20</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>startdate</column>
   </data>
  </field>
  <label>
   <rect>
    <x>334</x>
    <y>200</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Freight</string>
  </label>
 </rpthead>
 <pghead>
  <firstpage/>
  <height>5</height>
 </pghead>
 <pghead>
  <height>25</height>
  <label>
   <rect>
    <x>500</x>
    <y>5</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Tax</string>
  </label>
  <label>
   <rect>
    <x>5</x>
    <y>5</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Tax Code</string>
  </label>
  <line>
   <xstart>5</xstart>
   <ystart>20</ystart>
   <xend>745</xend>
   <yend>20</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>334</x>
    <y>5</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Freight</string>
  </label>
  <label>
   <rect>
    <x>700</x>
    <y>5</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Currency</string>
  </label>
  <label>
   <rect>
    <x>430</x>
    <y>5</y>
    <width>70</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Freight Taxed</string>
  </label>
  <label>
   <rect>
    <x>230</x>
    <y>5</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Sales</string>
  </label>
  <label>
   <rect>
    <x>600</x>
    <y>5</y>
    <width>90</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>Tax</string>
  </label>
 </pghead>
 <section>
  <name>detail</name>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>18</height>
   <field>
    <rect>
     <x>500</x>
     <y>0</y>
     <width>100</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_taxbase</column>
    </data>
   </field>
   <field>
    <rect>
     <x>334</x>
     <y>0</y>
     <width>100</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_freight</column>
    </data>
   </field>
   <field>
    <rect>
     <x>5</x>
     <y>0</y>
     <width>300</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>taxcode</column>
    </data>
   </field>
   <field>
    <rect>
     <x>600</x>
     <y>0</y>
     <width>90</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_tax</column>
    </data>
   </field>
   <field>
    <rect>
     <x>230</x>
     <y>0</y>
     <width>100</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_sales</column>
    </data>
   </field>
   <field>
    <rect>
     <x>440</x>
     <y>0</y>
     <width>50</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_taxfreight</column>
    </data>
   </field>
   <field>
    <rect>
     <x>700</x>
     <y>0</y>
     <width>50</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>taxauthcurr</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>15</height>
  <label>
   <rect>
    <x>615</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
  <field>
   <rect>
    <x>90</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
  <label>
   <rect>
    <x>0</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <field>
   <rect>
    <x>705</x>
    <y>0</y>
    <width>40</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
 </pgfoot>
</report>
